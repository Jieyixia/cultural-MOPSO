function param = update_global_archive(param)
phi = param.phi;
pop = param.pop;
nondominant = find(phi == 1);
nondominant = nondominant';

if isempty(param.global_archive)
    param.global_archive = [param.global_archive; pop(nondominant, :)];
    return
end

obj_value = param.obj_value;
cv = param.cv;
f = param.f;
g = param.g;
fn = length(f);
gn = length(g);

global_archive_size = size(param.global_archive, 1);
obj_value_ga = zeros(global_archive_size, fn);
cv_ga = zeros(global_archive_size, 1);
for i = 1 : fn
    obj_value_ga(:, i) = f{i}(param.global_archive);
end

for i = 1 : gn
    temp = g{i}(param.global_archive);
    cv_ga(:, i) = cv_ga(:, i) + temp .* (temp > 0);
end

add = [];
delete = [];
for i = nondominant
    
    obj_value_i = obj_value(i, :);
    cv_i = cv(i, :);
    
    dominated = [];
    for j = 1 : global_archive_size
        
        obj_value_j = obj_value_ga(j, :);
        cv_j = cv_ga(j);
        
        flag_1 = isdominate([obj_value_i; obj_value_j], [cv_i; cv_j], fn);
        if flag_1 == 1 % find solutions dominated by x_i
            dominated = [dominated, j]; %#ok<AGROW>
        end
        
        flag_2 = isdominate([obj_value_j; obj_value_i], [cv_j; cv_i], fn);
        if flag_2 == 1 % find if any solution dominate x_i
            break
        end
        
    end
    
    if flag_2
        continue
    else
        add = [add, i];
        delete = [delete, dominated];
    end
    
    
end

delete = unique(delete);
param.global_archive(delete, :) = [];
param.global_archive = [param.global_archive; pop(add, :)];

fprintf('size of global archive:%d', size(param.global_archive, 1))

% ÅÐ¶Ïz
% calculate objective function values
    f = param.f;
    g = param.g;
    fn = numel(f);
    gn = numel(g);
    obj_value = zeros(pop_size, fn);
    cv = zeros(pop_size, 1);
    for i = 1 : fn
        obj_value(:, i) = f{i}(pop);
        
    end
    for i = 1 : gn
        temp = g{i}(pop);
        cv = cv + temp .* (temp > 0); 
    end
    
    % find the individuals in the first non-dominant level
    S = cell(pop_size, 1);
    n = zeros(pop_size, 1);
    phi = zeros(pop_size, 1);
    
    for i = 1 : pop_size
        S{i} = [];
        for j = 1 : pop_size
            if isdominate(obj_value([i, j], :), cv([i, j]), fn) 
                % individual i dominates individual j
                S{i} = [S{i}; j];
            else
                if isdominate(obj_value([j, i], :), cv([j, i]), fn)
                    % individual j dominates individual i
                    n(i) = n(i) + 1;
                end
            end
        end
        if n(i) == 0
            phi(i) = 1;
        end
    end
    
    param.phi = phi;
    param.obj_value = obj_value;
    param.cv = cv;

end

function flag = isdominate(obj_value, cv, fn)
    
    flag = 0; 
    if cv(1) == 0 && cv(2) == 0     
        % if both solutions are feasible
        diff = obj_value(1, :) - obj_value(2, :);    
        if  length(find(diff <= 0)) == fn 
            if length(find(diff < 0)) >= 1
                flag = 1;
                return
            end
        end
    end

    if cv(1) == 0 && cv(2) > 0
        % if one is feasible, the other is not
        flag = 1;
        return
    end

    if cv(1) > 0 && cv(2) > 0
        % if both are infeasible
        if cv(1) < cv(2)
            flag = 1;
            return
        end
    end
end
